{
  "description": "Comprehensive Playwright test suite for user invitation functionality covering admin access controls, popup interactions, email validation, role selection, and all popup closure methods. Tests include positive scenarios, negative cases, and edge conditions to ensure robust user management features.",
  "generatedFiles": [
    {
      "fileName": "user-invitation.spec.ts",
      "code": "// User Invitation Functionality Test Suite\nimport { test, expect } from '@playwright/test';\n\ntest.describe('User Invitation Management - RA-2', () => {\n  const BASE_URL = 'https://robotesta.app';\n  \n  // Test data\n  const validEmail = 'testuser@example.com';\n  const invalidEmails = [\n    'invalid-email',\n    '@example.com',\n    'test@',\n    'test..test@example.com',\n    ''\n  ];\n  \n  // Setup and authentication helpers\n  async function loginAsAdmin(page) {\n    await page.goto(`${BASE_URL}/login`);\n    await page.fill('[data-testid=\"email-input\"]', 'admin@robotesta.com');\n    await page.fill('[data-testid=\"password-input\"]', 'admin123');\n    await page.click('[data-testid=\"login-button\"]');\n    await expect(page).toHaveURL(/.*dashboard.*/);\n  }\n  \n  async function loginAsRegularUser(page) {\n    await page.goto(`${BASE_URL}/login`);\n    await page.fill('[data-testid=\"email-input\"]', 'user@robotesta.com');\n    await page.fill('[data-testid=\"password-input\"]', 'user123');\n    await page.click('[data-testid=\"login-button\"]');\n    await expect(page).toHaveURL(/.*dashboard.*/);\n  }\n  \n  async function navigateToUsersPage(page) {\n    await page.click('[data-testid=\"users-menu\"]');\n    await expect(page).toHaveURL(/.*users.*/);\n    await expect(page.locator('h1')).toContainText('Users');\n  }\n\n  test.beforeEach(async ({ page }) => {\n    // Set up test environment and clear any existing state\n    await page.goto(BASE_URL);\n  });\n\n  test.describe('Admin Access Control', () => {\n    test('should show +Invite User button for admin users', async ({ page }) => {\n      await loginAsAdmin(page);\n      await navigateToUsersPage(page);\n      \n      const inviteButton = page.locator('[data-testid=\"invite-user-button\"]');\n      await expect(inviteButton).toBeVisible();\n      await expect(inviteButton).toContainText('+Invite User');\n      await expect(inviteButton).toBeEnabled();\n    });\n\n    test('should hide +Invite User button for regular users', async ({ page }) => {\n      await loginAsRegularUser(page);\n      await navigateToUsersPage(page);\n      \n      const inviteButton = page.locator('[data-testid=\"invite-user-button\"]');\n      await expect(inviteButton).not.toBeVisible();\n    });\n\n    test('should prevent direct API access for regular users', async ({ page }) => {\n      await loginAsRegularUser(page);\n      \n      // Attempt direct API call to invite endpoint\n      const response = await page.request.post(`${BASE_URL}/api/users/invite`, {\n        data: {\n          email: validEmail,\n          role: 'User'\n        }\n      });\n      \n      expect(response.status()).toBe(403);\n    });\n  });\n\n  test.describe('Invite User Popup Functionality', () => {\n    test.beforeEach(async ({ page }) => {\n      await loginAsAdmin(page);\n      await navigateToUsersPage(page);\n    });\n\n    test('should open invite popup with correct fields when clicking +Invite User', async ({ page }) => {\n      await page.click('[data-testid=\"invite-user-button\"]');\n      \n      // Verify popup is visible\n      const popup = page.locator('[data-testid=\"invite-user-popup\"]');\n      await expect(popup).toBeVisible();\n      \n      // Verify popup title\n      await expect(popup.locator('h2')).toContainText('Invite User');\n      \n      // Verify email field\n      const emailField = popup.locator('[data-testid=\"email-field\"]');\n      await expect(emailField).toBeVisible();\n      await expect(emailField).toHaveAttribute('type', 'email');\n      await expect(emailField).toHaveAttribute('placeholder', /email/i);\n      \n      // Verify role dropdown\n      const roleDropdown = popup.locator('[data-testid=\"role-dropdown\"]');\n      await expect(roleDropdown).toBeVisible();\n      \n      // Check dropdown options\n      await roleDropdown.click();\n      const userOption = popup.locator('[data-testid=\"role-option-user\"]');\n      const adminOption = popup.locator('[data-testid=\"role-option-admin\"]');\n      \n      await expect(userOption).toBeVisible();\n      await expect(userOption).toContainText('User');\n      await expect(adminOption).toBeVisible();\n      await expect(adminOption).toContainText('Admin');\n      \n      // Verify action buttons\n      await expect(popup.locator('[data-testid=\"ok-button\"]')).toBeVisible();\n      await expect(popup.locator('[data-testid=\"cancel-button\"]')).toBeVisible();\n      await expect(popup.locator('[data-testid=\"close-button\"]')).toBeVisible();\n    });\n\n    test('should have User role selected by default', async ({ page }) => {\n      await page.click('[data-testid=\"invite-user-button\"]');\n      \n      const roleDropdown = page.locator('[data-testid=\"role-dropdown\"]');\n      await expect(roleDropdown).toContainText('User');\n    });\n  });\n\n  test.describe('Successful User Invitation', () => {\n    test.beforeEach(async ({ page }) => {\n      await loginAsAdmin(page);\n      await navigateToUsersPage(page);\n      await page.click('[data-testid=\"invite-user-button\"]');\n    });\n\n    test('should successfully invite user with User role', async ({ page }) => {\n      const popup = page.locator('[data-testid=\"invite-user-popup\"]');\n      \n      // Fill email\n      await popup.locator('[data-testid=\"email-field\"]').fill(validEmail);\n      \n      // Select User role (default)\n      await popup.locator('[data-testid=\"role-dropdown\"]').click();\n      await popup.locator('[data-testid=\"role-option-user\"]').click();\n      \n      // Mock email service to verify invitation email\n      await page.route('**/api/users/invite', async route => {\n        await route.fulfill({\n          status: 200,\n          contentType: 'application/json',\n          body: JSON.stringify({\n            success: true,\n            message: 'Invitation sent successfully',\n            user: {\n              email: validEmail,\n              role: 'User',\n              status: 'Pending'\n            }\n          })\n        });\n      });\n      \n      // Submit invitation\n      await popup.locator('[data-testid=\"ok-button\"]').click();\n      \n      // Verify popup closes\n      await expect(popup).not.toBeVisible();\n      \n      // Verify confirmation message\n      const confirmationMessage = page.locator('[data-testid=\"success-message\"]');\n      await expect(confirmationMessage).toBeVisible();\n      await expect(confirmationMessage).toContainText('Invitation sent successfully');\n      \n      // Verify user appears in list with Pending status\n      const userRow = page.locator(`[data-testid=\"user-row-${validEmail}\"]`);\n      await expect(userRow).toBeVisible();\n      await expect(userRow.locator('[data-testid=\"user-email\"]')).toContainText(validEmail);\n      await expect(userRow.locator('[data-testid=\"user-role\"]')).toContainText('User');\n      await expect(userRow.locator('[data-testid=\"user-status\"]')).toContainText('Pending');\n    });\n\n    test('should successfully invite user with Admin role', async ({ page }) => {\n      const popup = page.locator('[data-testid=\"invite-user-popup\"]');\n      \n      // Fill email\n      await popup.locator('[data-testid=\"email-field\"]').fill('admin@example.com');\n      \n      // Select Admin role\n      await popup.locator('[data-testid=\"role-dropdown\"]').click();\n      await popup.locator('[data-testid=\"role-option-admin\"]').click();\n      \n      // Mock successful response\n      await page.route('**/api/users/invite', async route => {\n        await route.fulfill({\n          status: 200,\n          contentType: 'application/json',\n          body: JSON.stringify({\n            success: true,\n            message: 'Admin invitation sent successfully',\n            user: {\n              email: 'admin@example.com',\n              role: 'Admin',\n              status: 'Pending'\n            }\n          })\n        });\n      });\n      \n      await popup.locator('[data-testid=\"ok-button\"]').click();\n      \n      // Verify user appears with Admin role\n      const userRow = page.locator('[data-testid=\"user-row-admin@example.com\"]');\n      await expect(userRow.locator('[data-testid=\"user-role\"]')).toContainText('Admin');\n    });\n\n    test('should update user status from Pending to Accepted after invitation acceptance', async ({ page }) => {\n      // First invite a user\n      const popup = page.locator('[data-testid=\"invite-user-popup\"]');\n      await popup.locator('[data-testid=\"email-field\"]').fill(validEmail);\n      \n      await page.route('**/api/users/invite', async route => {\n        await route.fulfill({\n          status: 200,\n          contentType: 'application/json',\n          body: JSON.stringify({\n            success: true,\n            user: { email: validEmail, role: 'User', status: 'Pending' }\n          })\n        });\n      });\n      \n      await popup.locator('[data-testid=\"ok-button\"]').click();\n      \n      // Verify Pending status\n      let userRow = page.locator(`[data-testid=\"user-row-${validEmail}\"]`);\n      await expect(userRow.locator('[data-testid=\"user-status\"]')).toContainText('Pending');\n      \n      // Simulate user accepting invitation (mock status update)\n      await page.route('**/api/users/status', async route => {\n        await route.fulfill({\n          status: 200,\n          contentType: 'application/json',\n          body: JSON.stringify({\n            email: validEmail,\n            status: 'Accepted'\n          })\n        });\n      });\n      \n      // Trigger status refresh\n      await page.reload();\n      await navigateToUsersPage(page);\n      \n      // Verify status changed to Accepted\n      userRow = page.locator(`[data-testid=\"user-row-${validEmail}\"]`);\n      await expect(userRow.locator('[data-testid=\"user-status\"]')).toContainText('Accepted');\n    });\n  });\n\n  test.describe('Email Validation', () => {\n    test.beforeEach(async ({ page }) => {\n      await loginAsAdmin(page);\n      await navigateToUsersPage(page);\n      await page.click('[data-testid=\"invite-user-button\"]');\n    });\n\n    test('should show validation error for invalid email formats', async ({ page }) => {\n      const popup = page.locator('[data-testid=\"invite-user-popup\"]');\n      const emailField = popup.locator('[data-testid=\"email-field\"]');\n      const okButton = popup.locator('[data-testid=\"ok-button\"]');\n      \n      for (const invalidEmail of invalidEmails) {\n        await emailField.clear();\n        await emailField.fill(invalidEmail);\n        await okButton.click();\n        \n        // Verify validation error appears\n        const errorMessage = popup.locator('[data-testid=\"email-error\"]');\n        await expect(errorMessage).toBeVisible();\n        await expect(errorMessage).toContainText(/invalid.*email/i);\n        \n        // Verify popup doesn't close\n        await expect(popup).toBeVisible();\n      }\n    });\n\n    test('should prevent submission with empty email', async ({ page }) => {\n      const popup = page.locator('[data-testid=\"invite-user-popup\"]');\n      const okButton = popup.locator('[data-testid=\"ok-button\"]');\n      \n      await okButton.click();\n      \n      const errorMessage = popup.locator('[data-testid=\"email-error\"]');\n      await expect(errorMessage).toBeVisible();\n      await expect(errorMessage).toContainText(/email.*required/i);\n      await expect(popup).toBeVisible();\n    });\n\n    test('should show error for already invited email', async ({ page }) => {\n      const popup = page.locator('[data-testid=\"invite-user-popup\"]');\n      \n      await popup.locator('[data-testid=\"email-field\"]').fill('existing@example.com');\n      \n      // Mock duplicate email response\n      await page.route('**/api/users/invite', async route => {\n        await route.fulfill({\n          status: 409,\n          contentType: 'application/json',\n          body: JSON.stringify({\n            error: 'User already invited or exists',\n            code: 'DUPLICATE_EMAIL'\n          })\n        });\n      });\n      \n      await popup.locator('[data-testid=\"ok-button\"]').click();\n      \n      const errorMessage = popup.locator('[data-testid=\"email-error\"]');\n      await expect(errorMessage).toBeVisible();\n      await expect(errorMessage).toContainText(/already.*invited/i);\n    });\n  });\n\n  test.describe('Cancel Functionality', () => {\n    test.beforeEach(async ({ page }) => {\n      await loginAsAdmin(page);\n      await navigateToUsersPage(page);\n      await page.click('[data-testid=\"invite-user-button\"]');\n    });\n\n    test('should not change data or send emails when clicking Cancel', async ({ page }) => {\n      const popup = page.locator('[