{
  "description": "Test suite for RAB-113: AI Code Update and Refinement functionality. This suite covers the complete workflow of generating AI code, requesting updates through chat, viewing multiple code versions, and committing updated code. Tests include positive scenarios, edge cases, and error handling for the code refinement feature.",
  "generatedFiles": [
    {
      "fileName": "ai-code-updates.spec.ts",
      "code": "// RAB-113: AI Code Update and Refinement Tests\nimport { test, expect } from '@playwright/test';\n\ntest.describe('AI Code Updates and Refinements - RAB-113', () => {\n  test.beforeEach(async ({ page }) => {\n    await page.goto('https://robotesta.ai.com');\n    // Navigate to Generate AI Code page\n    await page.click('[data-testid=\"generate-ai-code\"]');\n    await expect(page).toHaveURL(/.*generate-ai-code.*/);\n  });\n\n  test('should keep chat input available after initial code generation', async ({ page }) => {\n    // Generate initial AI code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create a simple login test');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    \n    // Wait for code generation to complete\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"generated-code-content\"]')).toContainText('test');\n    \n    // Verify chat input is still available\n    await expect(page.locator('[data-testid=\"chat-input\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"chat-input\"]')).toBeEnabled();\n    await expect(page.locator('[data-testid=\"chat-submit-btn\"]')).toBeVisible();\n  });\n\n  test('should allow user to submit update request for existing generated code', async ({ page }) => {\n    // Generate initial code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create a basic form validation test');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    // Submit update request\n    const updateRequest = 'Add error handling and retry logic to the test';\n    await page.fill('[data-testid=\"chat-input\"]', updateRequest);\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    \n    // Verify update request was submitted\n    await expect(page.locator('[data-testid=\"chat-message\"]').last()).toContainText(updateRequest);\n    await expect(page.locator('[data-testid=\"processing-indicator\"]')).toBeVisible();\n  });\n\n  test('should display updated code in separate widget', async ({ page }) => {\n    // Generate initial code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create a navigation test');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    // Request code update\n    await page.fill('[data-testid=\"chat-input\"]', 'Add mobile responsive checks');\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    \n    // Wait for updated code generation\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).toBeVisible({ timeout: 30000 });\n    \n    // Verify both code widgets are present\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).toBeVisible();\n    \n    // Verify widgets have different content\n    const originalCode = await page.locator('[data-testid=\"generated-code-content\"]').textContent();\n    const updatedCode = await page.locator('[data-testid=\"updated-code-content\"]').textContent();\n    expect(originalCode).not.toBe(updatedCode);\n  });\n\n  test('should allow access to both code versions from chat history', async ({ page }) => {\n    // Generate initial code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create API testing code');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    // Request update\n    await page.fill('[data-testid=\"chat-input\"]', 'Add authentication headers');\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).toBeVisible({ timeout: 30000 });\n    \n    // Open chat history\n    await page.click('[data-testid=\"chat-history-btn\"]');\n    await expect(page.locator('[data-testid=\"chat-history-panel\"]')).toBeVisible();\n    \n    // Verify both code versions are accessible from history\n    const historyItems = page.locator('[data-testid=\"chat-history-item\"]');\n    await expect(historyItems).toHaveCount(2); // Initial generation + update\n    \n    // Click on first history item (original code)\n    await historyItems.first().click();\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    // Click on second history item (updated code)\n    await historyItems.last().click();\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).toBeVisible();\n  });\n\n  test('should allow user to open and review updated code', async ({ page }) => {\n    // Generate and update code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create database connection test');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    await page.fill('[data-testid=\"chat-input\"]', 'Add connection pooling and timeout handling');\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).toBeVisible({ timeout: 30000 });\n    \n    // Open updated code for review\n    await page.click('[data-testid=\"view-updated-code-btn\"]');\n    await expect(page.locator('[data-testid=\"code-review-modal\"]')).toBeVisible();\n    \n    // Verify code content is reviewable\n    await expect(page.locator('[data-testid=\"code-review-content\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"code-review-content\"]')).toContainText('test');\n    \n    // Verify review controls are available\n    await expect(page.locator('[data-testid=\"code-review-close-btn\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"code-review-fullscreen-btn\"]')).toBeVisible();\n    \n    // Close review modal\n    await page.click('[data-testid=\"code-review-close-btn\"]');\n    await expect(page.locator('[data-testid=\"code-review-modal\"]')).not.toBeVisible();\n  });\n\n  test('should allow updated code to be committed using same commit flow', async ({ page }) => {\n    // Generate and update code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create file upload test');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    await page.fill('[data-testid=\"chat-input\"]', 'Add file type validation');\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).toBeVisible({ timeout: 30000 });\n    \n    // Initiate commit flow for updated code\n    await page.click('[data-testid=\"commit-updated-code-btn\"]');\n    await expect(page.locator('[data-testid=\"commit-modal\"]')).toBeVisible();\n    \n    // Verify commit form fields\n    await expect(page.locator('[data-testid=\"commit-message-input\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"commit-branch-select\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"commit-file-name-input\"]')).toBeVisible();\n    \n    // Fill commit details\n    await page.fill('[data-testid=\"commit-message-input\"]', 'Add file type validation to upload test');\n    await page.selectOption('[data-testid=\"commit-branch-select\"]', 'feature/updated-tests');\n    await page.fill('[data-testid=\"commit-file-name-input\"]', 'file-upload-validation.spec.ts');\n    \n    // Submit commit\n    await page.click('[data-testid=\"commit-submit-btn\"]');\n    \n    // Verify commit success\n    await expect(page.locator('[data-testid=\"commit-success-message\"]')).toBeVisible({ timeout: 15000 });\n    await expect(page.locator('[data-testid=\"commit-success-message\"]')).toContainText('successfully committed');\n  });\n\n  test('should handle multiple sequential code updates', async ({ page }) => {\n    // Generate initial code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create basic user registration test');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    // First update\n    await page.fill('[data-testid=\"chat-input\"]', 'Add email validation');\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).toBeVisible({ timeout: 30000 });\n    \n    // Second update\n    await page.fill('[data-testid=\"chat-input\"]', 'Add password strength validation');\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).toBeVisible({ timeout: 30000 });\n    \n    // Verify chat history shows all interactions\n    await page.click('[data-testid=\"chat-history-btn\"]');\n    const historyItems = page.locator('[data-testid=\"chat-history-item\"]');\n    await expect(historyItems).toHaveCount(3); // Initial + 2 updates\n  });\n\n  test('should handle empty update requests gracefully', async ({ page }) => {\n    // Generate initial code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create login test');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    // Try to submit empty update request\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    \n    // Verify validation message\n    await expect(page.locator('[data-testid=\"chat-input-error\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"chat-input-error\"]')).toContainText('Please enter an update request');\n    \n    // Verify no new code widget is created\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).not.toBeVisible();\n  });\n\n  test('should maintain chat input state during code generation', async ({ page }) => {\n    // Generate initial code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create search functionality test');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    // Start typing update request\n    const partialRequest = 'Add pagination support';\n    await page.fill('[data-testid=\"chat-input\"]', partialRequest);\n    \n    // Verify input maintains value\n    await expect(page.locator('[data-testid=\"chat-input\"]')).toHaveValue(partialRequest);\n    \n    // Complete and submit request\n    await page.fill('[data-testid=\"chat-input\"]', partialRequest + ' and sorting options');\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    \n    // Verify input is cleared after submission\n    await expect(page.locator('[data-testid=\"chat-input\"]')).toHaveValue('');\n  });\n\n  test('should show loading state during code update generation', async ({ page }) => {\n    // Generate initial code\n    await page.fill('[data-testid=\"code-prompt-input\"]', 'Create data validation test');\n    await page.click('[data-testid=\"generate-code-btn\"]');\n    await expect(page.locator('[data-testid=\"generated-code-widget\"]')).toBeVisible();\n    \n    // Submit update request\n    await page.fill('[data-testid=\"chat-input\"]', 'Add comprehensive error handling');\n    await page.click('[data-testid=\"chat-submit-btn\"]');\n    \n    // Verify loading indicators\n    await expect(page.locator('[data-testid=\"update-generation-spinner\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"update-status-text\"]')).toContainText('Generating updated code');\n    \n    // Verify chat input is disabled during generation\n    await expect(page.locator('[data-testid=\"chat-input\"]')).toBeDisabled();\n    await expect(page.locator('[data-testid=\"chat-submit-btn\"]')).toBeDisabled();\n    \n    // Wait for completion\n    await expect(page.locator('[data-testid=\"updated-code-widget\"]')).toBeVisible({ timeout: 30000 });\n    \n    // Verify controls are re-enabled\n    await expect(page.locator('[data-testid=\"chat-input\"]')).toBeEnabled();\n    await expect(page.locator('[data-testid