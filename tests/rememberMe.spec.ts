import { test, expect } from '@playwright/test';

{
  "description": "Comprehensive test suite for RAB-9 'Remember Me' functionality covering all acceptance criteria including checkbox default state, session persistence across browser sessions, logout behavior, password change scenarios, and cross-browser compatibility.",
  "generatedFiles": [
    {
      "fileName": "remember-me.spec.ts",
      "code": "// RAB-9: Remember Me functionality test suite\nimport { test, expect, Browser, BrowserContext, Page } from '@playwright/test';\n\nconst LOGIN_URL = 'https://robotesta.app/login';\nconst TEST_EMAIL = 'test@example.com';\nconst TEST_PASSWORD = 'TestPassword123';\nconst NEW_PASSWORD = 'NewPassword456';\n\n// Helper function to perform login\nasync function performLogin(page: Page, email: string, password: string, rememberMe: boolean = false) {\n  await page.goto(LOGIN_URL);\n  await page.getByRole('textbox', { name: 'Enter emailaddress' }).fill(email);\n  await page.getByRole('textbox', { name: 'Enter Password' }).fill(password);\n  \n  if (rememberMe) {\n    await page.getByRole('checkbox', { name: 'Remember me' }).check();\n  }\n  \n  // Wait for sign in button to be enabled and click\n  await expect(page.getByRole('button', { name: 'Sign in' })).toBeEnabled();\n  await page.getByRole('button', { name: 'Sign in' }).click();\n}\n\n// Helper function to check if user is authenticated\nasync function isUserAuthenticated(page: Page): Promise<boolean> {\n  try {\n    await page.goto(LOGIN_URL);\n    // If redirected away from login page, user is authenticated\n    await page.waitForTimeout(2000);\n    return !page.url().includes('/login');\n  } catch {\n    return false;\n  }\n}\n\n// Helper function to logout user\nasync function performLogout(page: Page) {\n  // Navigate to dashboard or main page first\n  await page.goto('https://robotesta.app/dashboard');\n  // Look for logout button/link and click it\n  await page.getByRole('button', { name: /logout|sign out/i }).click();\n}\n\ntest.describe('RAB-9: Remember Me Functionality', () => {\n  \n  test.describe('AC1: Remember Me checkbox display and default state', () => {\n    test('should display Remember Me checkbox unchecked by default', async ({ page }) => {\n      await page.goto(LOGIN_URL);\n      \n      // Verify Remember Me checkbox is visible\n      const rememberMeCheckbox = page.getByRole('checkbox', { name: 'Remember me' });\n      await expect(rememberMeCheckbox).toBeVisible();\n      \n      // Verify checkbox is unchecked by default\n      await expect(rememberMeCheckbox).not.toBeChecked();\n      \n      // Verify Remember Me label is visible\n      await expect(page.getByText('Remember me')).toBeVisible();\n    });\n    \n    test('should allow user to check and uncheck Remember Me checkbox', async ({ page }) => {\n      await page.goto(LOGIN_URL);\n      \n      const rememberMeCheckbox = page.getByRole('checkbox', { name: 'Remember me' });\n      \n      // Check the checkbox\n      await rememberMeCheckbox.check();\n      await expect(rememberMeCheckbox).toBeChecked();\n      \n      // Uncheck the checkbox\n      await rememberMeCheckbox.uncheck();\n      await expect(rememberMeCheckbox).not.toBeChecked();\n    });\n  });\n  \n  test.describe('AC2: Remember Me with valid credentials - session persistence', () => {\n    test('should keep user authenticated across browser sessions when Remember Me is selected', async ({ browser }) => {\n      // Create first browser context\n      const context1 = await browser.newContext();\n      const page1 = context1.newPage();\n      \n      // Login with Remember Me checked\n      await performLogin(await page1, TEST_EMAIL, TEST_PASSWORD, true);\n      \n      // Verify successful login\n      await expect(page1).not.toHaveURL(LOGIN_URL);\n      \n      // Close first context to simulate browser session end\n      await context1.close();\n      \n      // Create new browser context to simulate new session\n      const context2 = await browser.newContext();\n      const page2 = context2.newPage();\n      \n      // Navigate to login page - should be redirected if remembered\n      const isAuthenticated = await isUserAuthenticated(await page2);\n      expect(isAuthenticated).toBeTruthy();\n      \n      await context2.close();\n    });\n    \n    test('should maintain authentication when navigating directly to protected pages', async ({ browser }) => {\n      const context1 = await browser.newContext();\n      const page1 = context1.newPage();\n      \n      // Login with Remember Me\n      await performLogin(await page1, TEST_EMAIL, TEST_PASSWORD, true);\n      await context1.close();\n      \n      // New session - try accessing protected page directly\n      const context2 = await browser.newContext();\n      const page2 = context2.newPage();\n      \n      await page2.goto('https://robotesta.app/dashboard');\n      // Should not be redirected to login page\n      await expect(page2).not.toHaveURL(LOGIN_URL);\n      \n      await context2.close();\n    });\n  });\n  \n  test.describe('AC3: Login without Remember Me - session not persisted', () => {\n    test('should require re-authentication when Remember Me is not selected', async ({ browser }) => {\n      // First session - login without Remember Me\n      const context1 = await browser.newContext();\n      const page1 = context1.newPage();\n      \n      await performLogin(await page1, TEST_EMAIL, TEST_PASSWORD, false);\n      \n      // Verify successful login\n      await expect(page1).not.toHaveURL(LOGIN_URL);\n      \n      await context1.close();\n      \n      // New session - should require re-authentication\n      const context2 = await browser.newContext();\n      const page2 = context2.newPage();\n      \n      const isAuthenticated = await isUserAuthenticated(await page2);\n      expect(isAuthenticated).toBeFalsy();\n      \n      // Should be on login page\n      await expect(page2).toHaveURL(LOGIN_URL);\n      \n      await context2.close();\n    });\n    \n    test('should redirect to login when accessing protected pages without Remember Me', async ({ browser }) => {\n      const context1 = await browser.newContext();\n      const page1 = context1.newPage();\n      \n      // Login without Remember Me\n      await performLogin(await page1, TEST_EMAIL, TEST_PASSWORD, false);\n      await context1.close();\n      \n      // New session - try accessing protected page\n      const context2 = await browser.newContext();\n      const page2 = context2.newPage();\n      \n      await page2.goto('https://robotesta.app/dashboard');\n      // Should be redirected to login page\n      await expect(page2).toHaveURL(LOGIN_URL);\n      \n      await context2.close();\n    });\n  });\n  \n  test.describe('AC4: Manual logout clears remembered session', () => {\n    test('should clear remembered session when user logs out manually', async ({ browser }) => {\n      // Login with Remember Me\n      const context1 = await browser.newContext();\n      const page1 = context1.newPage();\n      \n      await performLogin(await page1, TEST_EMAIL, TEST_PASSWORD, true);\n      \n      // Perform manual logout\n      await performLogout(await page1);\n      \n      // Verify redirected to login page\n      await expect(page1).toHaveURL(LOGIN_URL);\n      \n      await context1.close();\n      \n      // New session - should require authentication despite previous Remember Me\n      const context2 = await browser.newContext();\n      const page2 = context2.newPage();\n      \n      const isAuthenticated = await isUserAuthenticated(await page2);\n      expect(isAuthenticated).toBeFalsy();\n      \n      await context2.close();\n    });\n    \n    test('should require credentials after logout even with Remember Me previously selected', async ({ browser }) => {\n      const context1 = await browser.newContext();\n      const page1 = context1.newPage();\n      \n      // Login with Remember Me and then logout\n      await performLogin(await page1, TEST_EMAIL, TEST_PASSWORD, true);\n      await performLogout(await page1);\n      \n      await context1.close();\n      \n      // New session - try to access protected resource\n      const context2 = await browser.newContext();\n      const page2 = context2.newPage();\n      \n      await page2.goto('https://robotesta.app/dashboard');\n      await expect(page2).toHaveURL(LOGIN_URL);\n      \n      // Verify login form is displayed and functional\n      await expect(page2.getByRole('textbox', { name: 'Enter emailaddress' })).toBeVisible();\n      await expect(page2.getByRole('textbox', { name: 'Enter Password' })).toBeVisible();\n      \n      await context2.close();\n    });\n  });\n  \n  test.describe('AC5: Password change requires re-authentication', () => {\n    test('should require re-authentication after password change', async ({ browser }) => {\n      // Login with Remember Me\n      const context1 = await browser.newContext();\n      const page1 = context1.newPage();\n      \n      await performLogin(await page1, TEST_EMAIL, TEST_PASSWORD, true);\n      \n      // Navigate to profile/settings to change password\n      await page1.goto('https://robotesta.app/profile');\n      \n      // Change password (assuming there's a change password form)\n      await page1.getByRole('textbox', { name: /current password/i }).fill(TEST_PASSWORD);\n      await page1.getByRole('textbox', { name: /new password/i }).fill(NEW_PASSWORD);\n      await page1.getByRole('textbox', { name: /confirm password/i }).fill(NEW_PASSWORD);\n      await page1.getByRole('button', { name: /change password|update password/i }).click();\n      \n      await context1.close();\n      \n      // New session - should require re-authentication despite Remember Me\n      const context2 = await browser.newContext();\n      const page2 = context2.newPage();\n      \n      const isAuthenticated = await isUserAuthenticated(await page2);\n      expect(isAuthenticated).toBeFalsy();\n      \n      // Should be able to login with new password\n      await performLogin(await page2, TEST_EMAIL, NEW_PASSWORD, false);\n      await expect(page2).not.toHaveURL(LOGIN_URL);\n      \n      await context2.close();\n    });\n  });\n  \n  test.describe('AC6: Cross-browser compatibility', () => {\n    ['chromium', 'firefox', 'webkit'].forEach(browserName => {\n      test(`should work consistently in ${browserName}`, async ({ browser }) => {\n        test.skip(browser.browserType().name() !== browserName, `This test runs on ${browserName}`);\n        \n        const context = await browser.newContext();\n        const page = context.newPage();\n        \n        await page.goto(LOGIN_URL);\n        \n        // Test checkbox functionality\n        const rememberMeCheckbox = page.getByRole('checkbox', { name: 'Remember me' });\n        await expect(rememberMeCheckbox).toBeVisible();\n        await expect(rememberMeCheckbox).not.toBeChecked();\n        \n        // Test checking the checkbox\n        await rememberMeCheckbox.check();\n        await expect(rememberMeCheckbox).toBeChecked();\n        \n        // Test login with Remember Me\n        await performLogin(await page, TEST_EMAIL, TEST_PASSWORD, true);\n        await expect(page).not.toHaveURL(LOGIN_URL);\n        \n        await context.close();\n        \n        // Test session persistence\n        const newContext = await browser.newContext();\n        const newPage = newContext.newPage();\n        \n        const isAuthenticated = await isUserAuthenticated(await newPage);\n        expect(isAuthenticated).toBeTruthy();\n        \n        await newContext.close();\n      });\n    });\n  });\n  \n  test.describe('Edge Cases and Error Scenarios', () => {\n    test('should handle Remember Me with invalid credentials gracefully', async ({ page }) => {\n      await page.goto(LOGIN_URL);\n      \n      // Check Remember Me and try to login with invalid credentials\n      await page.getByRole('textbox', { name: 'Enter emailaddress' }).fill('invalid@email.com');\n      await page.getByRole('textbox', { name: 'Enter Password' }).fill('wrongpassword');\n      await page.getByRole('checkbox', { name: 'Remember me' }).check();\n      \n      await page.getByRole('button', { name: 'Sign in' }).click();\n      \n      // Should remain on login page with error message\n      await expect(page).toHaveURL(LOGIN_URL);\n      await expect(page.getByText(/invalid|error|incorrect/i)).toBeVisible();\n      \n      // Remember Me checkbox should still be checked\n      await expect(page.getByRole('checkbox', { name: 'Remember me' })).toBeChecked();\n    });\n    \n    test('should handle session expiry gracefully with Remember Me', async ({ browser }) => {\n      const context = await browser.newContext();\n      const page = context.newPage();\n      \n      // Login with Remember Me\n      await performLogin(await page, TEST_EMAIL, TEST_PASSWORD, true);\n      \n      // Simulate session expiry by clearing cookies\n      await context.clearCookies();\n      \n      // Try to access protected page\n      await page.goto('https://robotesta.app/dashboard');\n      \n      // Should be redirected to login page\n      await expect(page).toHaveURL(LOGIN_URL);\n      \n      await context.close();\n    });\n    \n    test('should maintain Remember Me state during form validation errors', async ({ page }) => {\n      await page.goto(LOGIN_URL);\n      \n      // Check Remember Me\n      await page.getByRole('checkbox', { name: 'Remember me' }).check();\n      \n      // Try to submit with empty fields\n      await page.getByRole('button', { name: 'Sign in' }).click();\n      \n      // Remember Me should still be checked after validation error\n      await expect(page.getByRole('checkbox', { name: 'Remember me' })).toBeChecked();\n    });\n    \n    test('should handle multiple concurrent sessions with Remember Me', async ({ browser }) => {\n      // Create multiple contexts to simulate multiple browser windows\n      const context