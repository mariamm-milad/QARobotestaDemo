{
  "description": "Comprehensive test suite for user invitation functionality (RA-2) covering admin-only access, popup interactions, successful invitations, email sending, user list updates, and all popup closure methods. Includes positive scenarios, negative test cases, and edge cases for robust validation.",
  "generatedFiles": [
    {
      "fileName": "user-invitation.spec.ts",
      "code": "// Test suite for RA-2: Admin User Invitation Functionality\nimport { test, expect } from '@playwright/test';\n\ntest.describe('User Invitation Functionality - RA-2', () => {\n  let page;\n\n  test.beforeEach(async ({ browser }) => {\n    page = await browser.newPage();\n  });\n\n  test.afterEach(async () => {\n    await page.close();\n  });\n\n  // Helper function to login as admin\n  async function loginAsAdmin() {\n    await page.goto('x');\n    await page.fill('[data-testid=\"username\"]', 'admin@test.com');\n    await page.fill('[data-testid=\"password\"]', 'adminPassword123');\n    await page.click('[data-testid=\"login-button\"]');\n    await page.waitForURL('**/users');\n  }\n\n  // Helper function to login as regular user\n  async function loginAsRegularUser() {\n    await page.goto('x');\n    await page.fill('[data-testid=\"username\"]', 'user@test.com');\n    await page.fill('[data-testid=\"password\"]', 'userPassword123');\n    await page.click('[data-testid=\"login-button\"]');\n    await page.waitForURL('**/dashboard');\n  }\n\n  // Helper function to navigate to Users page\n  async function navigateToUsersPage() {\n    await page.click('[data-testid=\"users-menu\"]');\n    await page.waitForURL('**/users');\n  }\n\n  test('AC1: Verify only admin users can see and access +Invite User button', async () => {\n    // Test admin user can see the button\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    const inviteButton = page.locator('[data-testid=\"invite-user-button\"]');\n    await expect(inviteButton).toBeVisible();\n    await expect(inviteButton).toBeEnabled();\n    await expect(inviteButton).toHaveText('+Invite User');\n  });\n\n  test('AC1: Verify regular users cannot see +Invite User button', async () => {\n    // Test regular user cannot see the button\n    await loginAsRegularUser();\n    await navigateToUsersPage();\n    \n    const inviteButton = page.locator('[data-testid=\"invite-user-button\"]');\n    await expect(inviteButton).not.toBeVisible();\n  });\n\n  test('AC2: Verify +Invite User button opens popup with correct fields', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    // Click the invite user button\n    await page.click('[data-testid=\"invite-user-button\"]');\n    \n    // Verify popup is visible\n    const popup = page.locator('[data-testid=\"invite-user-popup\"]');\n    await expect(popup).toBeVisible();\n    \n    // Verify popup title\n    await expect(page.locator('[data-testid=\"popup-title\"]')).toHaveText('Invite User');\n    \n    // Verify email text field\n    const emailField = page.locator('[data-testid=\"email-input\"]');\n    await expect(emailField).toBeVisible();\n    await expect(emailField).toHaveAttribute('type', 'email');\n    await expect(emailField).toHaveAttribute('placeholder', /email/i);\n    \n    // Verify role dropdown\n    const roleDropdown = page.locator('[data-testid=\"role-dropdown\"]');\n    await expect(roleDropdown).toBeVisible();\n    \n    // Click dropdown to verify options\n    await roleDropdown.click();\n    await expect(page.locator('[data-testid=\"role-option-user\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"role-option-admin\"]')).toBeVisible();\n    \n    // Verify popup buttons\n    await expect(page.locator('[data-testid=\"popup-ok-button\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"popup-cancel-button\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"popup-close-x\"]')).toBeVisible();\n  });\n\n  test('AC3: Verify successful invitation with User role', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    // Get initial user count\n    const initialUserCount = await page.locator('[data-testid=\"user-row\"]').count();\n    \n    // Open invite popup\n    await page.click('[data-testid=\"invite-user-button\"]');\n    \n    // Fill in invitation details\n    await page.fill('[data-testid=\"email-input\"]', 'newuser@test.com');\n    await page.selectOption('[data-testid=\"role-dropdown\"]', 'User');\n    \n    // Submit invitation\n    await page.click('[data-testid=\"popup-ok-button\"]');\n    \n    // Verify confirmation message\n    const confirmationMessage = page.locator('[data-testid=\"confirmation-message\"]');\n    await expect(confirmationMessage).toBeVisible();\n    await expect(confirmationMessage).toContainText('Invitation sent successfully');\n    \n    // Verify popup is closed\n    await expect(page.locator('[data-testid=\"invite-user-popup\"]')).not.toBeVisible();\n    \n    // Verify user appears in list with Pending status\n    await page.waitForTimeout(2000); // Wait for list to update\n    const newUserRow = page.locator('[data-testid=\"user-row\"]').filter({ hasText: 'newuser@test.com' });\n    await expect(newUserRow).toBeVisible();\n    await expect(newUserRow.locator('[data-testid=\"user-status\"]')).toHaveText('Pending');\n    await expect(newUserRow.locator('[data-testid=\"user-role\"]')).toHaveText('User');\n    \n    // Verify user count increased\n    const finalUserCount = await page.locator('[data-testid=\"user-row\"]').count();\n    expect(finalUserCount).toBe(initialUserCount + 1);\n  });\n\n  test('AC3: Verify successful invitation with Admin role', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    // Open invite popup\n    await page.click('[data-testid=\"invite-user-button\"]');\n    \n    // Fill in invitation details\n    await page.fill('[data-testid=\"email-input\"]', 'newadmin@test.com');\n    await page.selectOption('[data-testid=\"role-dropdown\"]', 'Admin');\n    \n    // Submit invitation\n    await page.click('[data-testid=\"popup-ok-button\"]');\n    \n    // Verify confirmation message\n    await expect(page.locator('[data-testid=\"confirmation-message\"]')).toBeVisible();\n    \n    // Verify user appears in list with correct role\n    const newUserRow = page.locator('[data-testid=\"user-row\"]').filter({ hasText: 'newadmin@test.com' });\n    await expect(newUserRow).toBeVisible();\n    await expect(newUserRow.locator('[data-testid=\"user-role\"]')).toHaveText('Admin');\n  });\n\n  test('AC4: Verify Cancel button does not change data or send emails', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    // Get initial user count\n    const initialUserCount = await page.locator('[data-testid=\"user-row\"]').count();\n    \n    // Open invite popup\n    await page.click('[data-testid=\"invite-user-button\"]');\n    \n    // Fill in invitation details\n    await page.fill('[data-testid=\"email-input\"]', 'cancelled@test.com');\n    await page.selectOption('[data-testid=\"role-dropdown\"]', 'User');\n    \n    // Click Cancel button\n    await page.click('[data-testid=\"popup-cancel-button\"]');\n    \n    // Verify popup is closed\n    await expect(page.locator('[data-testid=\"invite-user-popup\"]')).not.toBeVisible();\n    \n    // Verify no confirmation message\n    await expect(page.locator('[data-testid=\"confirmation-message\"]')).not.toBeVisible();\n    \n    // Verify user count unchanged\n    const finalUserCount = await page.locator('[data-testid=\"user-row\"]').count();\n    expect(finalUserCount).toBe(initialUserCount);\n    \n    // Verify user not in list\n    const cancelledUserRow = page.locator('[data-testid=\"user-row\"]').filter({ hasText: 'cancelled@test.com' });\n    await expect(cancelledUserRow).not.toBeVisible();\n  });\n\n  test('AC5: Verify popup can be closed by X icon', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    await page.click('[data-testid=\"invite-user-button\"]');\n    await expect(page.locator('[data-testid=\"invite-user-popup\"]')).toBeVisible();\n    \n    // Close by X icon\n    await page.click('[data-testid=\"popup-close-x\"]');\n    await expect(page.locator('[data-testid=\"invite-user-popup\"]')).not.toBeVisible();\n  });\n\n  test('AC5: Verify popup can be closed by Ok button (after filling form)', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    await page.click('[data-testid=\"invite-user-button\"]');\n    await page.fill('[data-testid=\"email-input\"]', 'okbutton@test.com');\n    await page.selectOption('[data-testid=\"role-dropdown\"]', 'User');\n    \n    // Close by Ok button\n    await page.click('[data-testid=\"popup-ok-button\"]');\n    await expect(page.locator('[data-testid=\"invite-user-popup\"]')).not.toBeVisible();\n  });\n\n  test('AC5: Verify popup can be closed by Cancel button', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    await page.click('[data-testid=\"invite-user-button\"]');\n    \n    // Close by Cancel button\n    await page.click('[data-testid=\"popup-cancel-button\"]');\n    await expect(page.locator('[data-testid=\"invite-user-popup\"]')).not.toBeVisible();\n  });\n\n  test('AC5: Verify popup can be closed by clicking outside', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    await page.click('[data-testid=\"invite-user-button\"]');\n    await expect(page.locator('[data-testid=\"invite-user-popup\"]')).toBeVisible();\n    \n    // Click outside popup (on backdrop)\n    await page.click('[data-testid=\"popup-backdrop\"]', { position: { x: 10, y: 10 } });\n    await expect(page.locator('[data-testid=\"invite-user-popup\"]')).not.toBeVisible();\n  });\n\n  // Edge Cases and Error Scenarios\n  test('Edge Case: Verify validation for empty email field', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    await page.click('[data-testid=\"invite-user-button\"]');\n    await page.selectOption('[data-testid=\"role-dropdown\"]', 'User');\n    \n    // Try to submit without email\n    await page.click('[data-testid=\"popup-ok-button\"]');\n    \n    // Verify error message or popup stays open\n    await expect(page.locator('[data-testid=\"email-error\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"invite-user-popup\"]')).toBeVisible();\n  });\n\n  test('Edge Case: Verify validation for invalid email format', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    await page.click('[data-testid=\"invite-user-button\"]');\n    await page.fill('[data-testid=\"email-input\"]', 'invalid-email');\n    await page.selectOption('[data-testid=\"role-dropdown\"]', 'User');\n    \n    await page.click('[data-testid=\"popup-ok-button\"]');\n    \n    // Verify error message\n    await expect(page.locator('[data-testid=\"email-error\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"email-error\"]')).toContainText('Please enter a valid email');\n  });\n\n  test('Edge Case: Verify validation for duplicate email invitation', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    // First invitation\n    await page.click('[data-testid=\"invite-user-button\"]');\n    await page.fill('[data-testid=\"email-input\"]', 'duplicate@test.com');\n    await page.selectOption('[data-testid=\"role-dropdown\"]', 'User');\n    await page.click('[data-testid=\"popup-ok-button\"]');\n    \n    await page.waitForTimeout(1000);\n    \n    // Try to invite same email again\n    await page.click('[data-testid=\"invite-user-button\"]');\n    await page.fill('[data-testid=\"email-input\"]', 'duplicate@test.com');\n    await page.selectOption('[data-testid=\"role-dropdown\"]', 'User');\n    await page.click('[data-testid=\"popup-ok-button\"]');\n    \n    // Verify error message for duplicate\n    await expect(page.locator('[data-testid=\"error-message\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"error-message\"]')).toContainText('User already invited or exists');\n  });\n\n  test('Edge Case: Verify no role selected validation', async () => {\n    await loginAsAdmin();\n    await navigateToUsersPage();\n    \n    await page.click('[data-testid=\"invite-user-button\"]